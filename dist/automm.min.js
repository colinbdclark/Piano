/*! Automagic Music Maker 0.2.0, Copyright 2014Myles Borins | automagicmusicmaker.com */

var automm=automm||{};!function(){"use strict";fluid.defaults("automm.oscillator",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","autoInit"],components:{polysynth:{type:"flock.synth.polyphonic",options:{synthDef:{id:"carrier",ugen:"{oscillator}.model.osc",freq:"{oscillator}.model.freq",mul:{id:"env",ugen:"flock.ugen.env.simpleASR",attack:"{oscillator}.model.attack",sustain:"{oscillator}.model.sustain",release:"{oscillator}.model.release"}}}}},model:{arpActive:!1,freq:440,osc:"flock.ugen.sin",attack:.25,sustain:.7,release:.5,gate:0,afour:69,afourFreq:440,octaveNotes:12,isShift:!1},events:{onNote:null,afterNote:null,onClick:null,afterClick:null,afterInstrumentUpdate:null},paramMap:{freq:"carrier.freq",attack:"env.attack",sustain:"env.sustain",release:"env.release",gate:"env.gate"}}),automm.oscillator.preInit=function(a){flock.enviro.shared||flock.init(),a.update=function(b,c){a.model.hasOwnProperty(b)&&a.applier.requestChange(b,c)},a.onNote=function(b){var c;"object"==typeof b&&(b=b[0].id),c=automm.midiToFreq(b,a.model.octaveNotes,a.model.afour,a.model.afourFreq),a.polysynth.noteOn(b,{"carrier.freq":c})},a.afterNote=function(b){"object"==typeof b&&(b=b[0].id),a.isShift||a.polysynth.noteOff(b)},a.onClick=function(b){a.model.arpActive||a.onNote(b)},a.afterClick=function(b){a.model.arpActive||a.afterNote(b)}},automm.oscillator.finalInit=function(a){a.applier.modelChanged.addListener("*",function(b,c,d){var e=d[0].path,f=a.options.paramMap[e];a.polysynth.input(f,b[e])}),flock.enviro.shared.play(),a.events.onNote.addListener(a.onNote),a.events.afterNote.addListener(a.afterNote),a.events.onClick.addListener(a.onClick),a.events.afterClick.addListener(a.afterClick),a.events.afterInstrumentUpdate.addListener(a.update)},automm.midiToFreq=function(a,b,c,d){return Math.pow(2,(a-c)/b)*d}}(jQuery);var automm=automm||{};!function(a){"use strict";fluid.defaults("automm.arpeggiator",{gradeNames:["fluid.viewComponent","autoInit"],model:{arpActive:!1,notificationShowing:!1,interval:150,scale:"major",mode:"ionian",arpPattern:[0,2,4],firstNote:60,octaves:1,octaveNotes:12,canon:{modes:{ionian:0,dorian:1,phyrgian:2,lydian:3,mixolydian:4,aeolian:5,locrian:6},scales:{major:[2,2,1,2,2,2,1],minor:[2,2,1,2,2,1,2]}}},components:{metronome:{type:"flock.scheduler.async",options:{components:{timeConverter:{type:"flock.convert.ms"}}}}},events:{onClick:null,afterClick:null,onNote:null,afterNote:null,metronomeEvent:null,afterInstrumentUpdate:null,arpActive:null}}),automm.arpeggiator.preInit=function(b){b.runningArpeggiators={},b.currentlyPlaying=[],b.drawNotification=function(a){var c,d,e=b.container.find("#viewBox");b.model.notificationShowing=!0,e=e[0],b.svg=d3.select(e),c=b.svg.attr("viewBox").split(" "),fluid.each(c,function(a,b){c[b]=parseFloat(a)}),b.svgTextGroup=b.svg.append("g"),d=b.svgTextGroup.append("rect"),d.attr("x",c[2]/4),d.attr("y",c[3]/4),d.attr("height","50%"),d.attr("width","50%"),d.attr("fill","black"),d.attr("opacity",.5),d.attr("rx","20"),d.attr("ry","20"),b.svgText=b.svgTextGroup.append("text"),b.svgText.attr("x",c[2]/2),b.svgText.attr("y",c[3]/1.8),b.svgText.attr("text-anchor","middle"),b.svgText.attr("fill","white"),b.svgText.attr("font-size",25),b.svgText.text(a?"Arpeggiator On":"Arpeggiator Off"),setTimeout(b.removeNotification,500)},b.removeNotification=function(){b.svgTextGroup.remove(),b.model.notificationShowing=!1},b.onClick=function(a){b.model.arpActive&&(a=parseFloat(a[0].id),b.startArpeggiator(a))},b.afterClick=function(a){b.model.arpActive&&(a=parseFloat(a[0].id),b.stopArpeggiator(a))},b.bindAlt=function(){a(document).keydown(function(a){a.altKey!==!0||b.model.notificationShowing||(b.update("arpActive",!b.model.arpActive),b.events.arpActive.fire(b.model.arpActive))})},b.startMetronome=function(a){a=a||b.model.interval,b.metronome.repeat(a,b.events.metronomeEvent.fire)},b.stopMetronome=function(a){a=a||b.model.interval,b.metronome.clearRepeat(a)},b.startArpeggiator=function(c){var d=0,e=!0,f=function(){var f={low:b.model.firstNote,high:b.model.octaves*b.model.octaveNotes+b.model.firstNote},g=automm.whichNote(c,b.model.canon.scales[b.model.scale],b.model.canon.modes[b.model.mode],b.model.arpPattern,d,f),h=d-1;-1===h&&(h=b.model.arpPattern.length-1),h=automm.whichNote(c,b.model.canon.scales[b.model.scale],b.model.canon.modes[b.model.mode],b.model.arpPattern,h,f),e?e=!1:(b.events.afterNote.fire(h),b.currentlyPlaying.splice(a.inArray(g,b.currentlyPlaying),1)),b.events.onNote.fire(g),b.currentlyPlaying.push(g),d>=b.model.arpPattern.length-1?d=0:d+=1};void 0===b.runningArpeggiators[c]&&(b.runningArpeggiators[c]=[]),b.runningArpeggiators[c].push(f),b.events.metronomeEvent.addListener(f)},b.stopArpeggiator=function(a){fluid.each(b.runningArpeggiators[a],function(a){b.removeMetronomeEvent(a)}),b.runningArpeggiators[a].length=0,fluid.each(b.currentlyPlaying,function(a){b.events.afterNote.fire(a)})},b.clearArpeggiators=function(){fluid.each(b.runningArpeggiators,function(a){b.stopArpeggiator(a)})},b.setMetronomeEvent=function(a){b.events.metronomeEvent.addListener(a)},b.removeMetronomeEvent=function(a){b.events.metronomeEvent.removeListener(a)},b.update=function(a,c){return b.applier.requestChange(a,c),b}},automm.arpeggiator.finalInit=function(a){a.startMetronome(a.model.interval),a.events.afterInstrumentUpdate.addListener(a.update),a.events.onClick.addListener(a.onClick),a.events.afterClick.addListener(a.afterClick),a.events.arpActive.addListener(a.drawNotification),a.bindAlt(),a.applier.modelChanged.addListener("interval",function(b,c){a.stopMetronome(c.interval),a.startMetronome(b.interval)})},automm.relativeScale=function(a,b){var c,d=[];for(c=0;c<a.length;c+=1)d[c]=0===c?0:d[c-1]+a[(c-1+b)%a.length];return d},automm.whichNote=function(a,b,c,d,e,f){var g=automm.relativeScale(b,c),h=a+g[d[e]];return h=automm.offsetMod(h,f)},automm.offsetMod=function(a,b){var c=b.high-b.low;return a-b.low<0?(a+=c,a=automm.offsetMod(a,b)):a>=b.high&&(a-=c,a=automm.offsetMod(a,b)),a}}(jQuery);var automm=automm||{};!function(a){"use strict";fluid.defaults("automm.aria",{gradeNames:["fluid.viewComponent","autoInit"],model:{notes:["C","C-Sharp","D","D-Sharp","E","F","F-Sharp","G","G-Sharp","A","A-Sharp","B"],octaveNotes:12,renderedNotes:[],playingNotes:[]},events:{afterUpdate:null,onClick:null,afterClick:null,onSelect:null}}),automm.aria.preInit=function(b){b.currentlySelected=null,b.getNotes=function(){var a=b.container.find(".note");fluid.each(a,function(a,c){b.model.renderedNotes[c]=a.id}),b.model.renderedNotes.sort(),fluid.each(b.model.renderedNotes,function(a,c){b.model.renderedNotes[c]={number:a,name:b.model.notes[a%12]+(Math.floor(a/12)-1)}})},b.setTitle=function(){var a=b.container.find("#aria"),c=b.container.children()[0].id;a.append("<div id='ariaTitle'>AutoMM "+b.container[0].id+" type: "+c+"</div>")},b.setDescription=function(){var a=b.container.find("#aria"),c=b.container.children()[0].id;a.append("<div id='ariaDescription'>Welcome to the Automagic Music Maker Within this application you will find a "+c+" in which you can interact with.  The "+c+" has "+b.model.renderedNotes.length+" notes starting with "+b.model.renderedNotes[0].name+" and ending with "+b.model.renderedNotes[b.model.renderedNotes.length-1].name+" you can use the left and right keys to move between notes, and press the space bar to activate them. You can deactivate individual notes by pressing spacebar a second time while it is selected. If you find that you have too many notes playing at a time, you can stop them all by hitting escape. The application also has an arpeggiator, which plays note patterns based on the first note you press. To enable the arpeggiator, press alt at any time. This application does not follow aria standards, and you will not hear any notification of where your current selection is, but don't fret, this was a design choice. It was found to be too distracting to play the piano while having your screen reader constantly yelling over top. I plan to add keyboard bindings in the near future, this should make the application much more pleasurable to interact with.  If you have any question or suggestions please email me at myles DOT borins AT gmail DOT com or tweet me @the_alpha_nerd<div>")},b.render=function(){var a=b.container.find("#aria");a.length<1&&b.container.append("<div id='aria' style='display:none;'></div>"),a.empty(),b.setTitle(),b.setDescription()},b.onActivation=function(c){var d=c.id,e=a.inArray(d,b.model.playingNotes);c=a(c),e>-1?(b.model.playingNotes.splice(e,1),b.events.afterClick.fire(c)):(b.model.playingNotes[b.model.playingNotes.length]=d,b.events.onClick.fire(c))},b.escaped=function(){fluid.each(b.model.playingNotes,function(a){a=b.container.find("#"+a),b.events.afterClick.fire(a)}),b.model.playingNotes=[]},b.bindEscape=function(){a(document).keydown(function(a){27===a.keyCode&&b.escaped()})},b.fluidInit=function(){var c=b.container.children().eq(0),d=a(automm.fetchNotes(b.container,b.model.renderedNotes));c.fluid("tabbable"),c.fluid("selectable",{direction:fluid.a11y.orientation.HORIZONTAL,selectableElements:d,autoSelectFirstItem:!1,onSelect:function(a){b.currentlySelected=a,b.events.onSelect.fire(a)}}),c.fluid("activatable",function(){b.onActivation(b.currentlySelected)})},b.update=function(){b.getNotes(),b.render(),b.fluidInit()}},automm.aria.finalInit=function(a){a.bindEscape(),a.update(),a.events.afterUpdate.addListener(a.update)},automm.fetchNotes=function(a,b){return fluid.transform(b,function(b){var c="#"+b.number;return a.find(c)[0]})}}(jQuery);var automm=automm||{};!function(){"use strict";fluid.defaults("automm.piano",{gradeNames:["fluid.viewComponent","autoInit"],model:{firstNote:60,octaves:1,octaveNotes:12,padding:50,pattern:["white","black","white","black","white","white","black","white","black","white","black","white"],keys:{white:{width:50,height:200,stroke:"black",fill:"white",highlight:"yellow",selected:"blue",notes:[]},black:{width:30,height:125,stroke:"black",fill:"black",highlight:"yellow",selected:"blue",notes:[]}},viewBox:{width:null,height:null}},events:{afterUpdate:null,afterInstrumentUpdate:null,afterNoteCalc:null,getNoteCalc:null}}),automm.piano.preInit=function(a){a.setup=function(){var b;for(a.model.keys.white.notes=[],a.model.keys.black.notes=[],b=a.model.firstNote;b<a.model.firstNote+a.model.octaves*a.model.octaveNotes;b+=1)a.model.keys[a.model.pattern[b%a.model.octaveNotes]].notes.push(b);a.model.whiteNotes=a.model.keys.white.notes.length,a.model.blackNotes=a.model.keys.black.notes.length,a.updateValue("viewbox",{width:a.model.keys.white.width*a.model.whiteNotes+a.model.padding,height:a.model.keys.white.height+a.model.padding}),a.model.viewbox.dim="0 0 "+a.model.viewbox.width+" "+a.model.viewbox.height},a.drawNote=function(b,c,d,e){var f=a.noteGroup.append("rect");f.style("stroke",b.stroke),f.style("fill",b.fill),f.attr("x",c),f.attr("y",d),f.attr("width",b.width),f.attr("height",b.height),f.attr("id",e),f.attr("class","note"),f.attr("noteType",b.fill)},a.render=function(){var b,c,d=-(a.model.keys.black.width/2),e=0;for(a.model.keys.white.notes[0]>a.model.keys.black.notes[0]&&(d=d-a.model.keys.white.width+a.model.keys.black.width/2),c=0;c<a.model.keys.white.notes.length;c+=1)a.model.keys.white.notes[0]>a.model.keys.black.notes[0]?a.drawNote(a.model.keys.white,c*a.model.keys.white.width+a.model.keys.black.width/2,0,a.model.keys.white.notes[c]):a.drawNote(a.model.keys.white,c*a.model.keys.white.width,0,a.model.keys.white.notes[c]);for(c=a.model.firstNote;c<a.model.octaves*a.model.octaveNotes+a.model.firstNote;c+=1)"black"===a.model.pattern[c%a.model.octaveNotes]&&(d+=a.model.keys.white.width,a.drawNote(a.model.keys.black,d,0,a.model.keys.black.notes[e]),e+=1),a.model.pattern[c%a.model.octaveNotes]===b&&(d+=a.model.keys.white.width),b=a.model.pattern[c%a.model.octaveNotes]},a.draw=function(){a.setup(),a.d3container=d3.select("#"+a.container.attr("id")).select("#piano");var b=a.d3container.append("svg");b.attr("style","height: 100%;"),b.attr("viewBox",a.model.viewbox.dim),b.attr("role","application"),b.attr("focusable",!0),b.attr("tabindex","0"),b.attr("id","viewBox"),b.attr("aria-labelledby","ariaTitle"),b.attr("aria-describedby","ariaDescription"),a.noteGroup=b.append("g"),a.noteGroup.attr("transform","translate("+a.model.padding/2+","+a.model.padding/2+")"),a.noteGroup.attr("id","noteGroup"),a.noteGroup.attr("focusable",!0),a.render()},a.updateValue=function(b,c){a.applier.requestChange(b,c)},a.update=function(b,c){a.applier.requestChange(b,c),a.container.children("#piano").empty(),a.draw(),a.events.afterUpdate.fire()},a.sendNoteCalc=function(){a.events.afterNoteCalc.fire(a.model.keys)}},automm.piano.finalInit=function(a){var b=a.container.find("#piano").length;a.model.auto&&1>b&&(a.container.append("<div id='piano'></div>"),b=1),b>0&&(a.draw(),a.events.afterUpdate.fire(),a.events.afterInstrumentUpdate.addListener(a.update),a.events.getNoteCalc.addListener(a.sendNoteCalc))}}();var automm=automm||{};!function(){"use strict";fluid.defaults("automm.grid",{gradeNames:["fluid.viewComponent","autoInit"],model:{auto:!1,columns:8,rows:8,firstNote:60,octaves:1,octaveNotes:12,padding:50,pattern:["white","black","white","black","white","white","black","white","black","white","black","white"],keys:{white:{width:50,height:50,stroke:"black",fill:"white",highlight:"yellow",selected:"blue",notes:[]},black:{width:50,height:50,stroke:"black",fill:"black",highlight:"yellow",selected:"blue",notes:[]}},viewBox:{height:null,width:null}},events:{afterUpdate:null,onNote:null,afterNote:null,afterInstrumentUpdate:null,afterNoteCalc:null,getNoteCalc:null}}),automm.grid.preInit=function(a){a.setup=function(){var b,c=a.model.firstNote;for(a.model.keys.white.notes=[],a.model.keys.black.notes=[],b=0;b<a.model.columns*a.model.rows;b+=1)a.model.keys[a.model.pattern[b%a.model.octaveNotes]].notes.push(c),c+=1;a.updateValue("viewbox",{width:a.model.keys.white.width*a.model.columns+a.model.padding,height:a.model.keys.white.height*a.model.rows+a.model.padding}),a.model.viewbox.dim="0 0 "+a.model.viewbox.width+" "+a.model.viewbox.height},a.drawNote=function(b,c,d,e){var f=a.noteGroup.append("rect");f.style("stroke",b.stroke),f.style("fill",b.fill),f.attr("x",c),f.attr("y",d),f.attr("width",b.width),f.attr("height",b.height),f.attr("id",e),f.attr("class","note"),f.attr("noteType",b.fill)},a.calcNoteDim=function(b,c,d){var e=c-a.model.firstNote;return"width"===d?e%=a.model.columns:e=Math.floor(e/a.model.columns),e*=b[d]},a.render=function(){var b,c,d={};for(c=0;c<a.model.keys.white.notes.length;c+=1)b=a.model.keys.white.notes[c],d.width=a.calcNoteDim(a.model.keys.white,b,"width"),d.height=a.calcNoteDim(a.model.keys.white,b,"height"),a.drawNote(a.model.keys.white,d.width,d.height,b);for(c=0;c<a.model.keys.black.notes.length;c+=1)b=a.model.keys.black.notes[c],d.width=a.calcNoteDim(a.model.keys.black,b,"width"),d.height=a.calcNoteDim(a.model.keys.black,b,"height"),a.drawNote(a.model.keys.black,d.width,d.height,b)},a.draw=function(){a.setup(),a.d3container=d3.select("#"+a.container.attr("id")).select("#grid");var b=a.d3container.append("svg");b.attr("style","height: 100%;"),b.attr("viewBox",a.model.viewbox.dim),b.attr("role","application"),b.attr("focusable",!0),b.attr("tabindex","0"),b.attr("id","viewBox"),b.attr("aria-labelledby","ariaTitle"),a.noteGroup=b.append("g"),a.noteGroup.attr("transform","translate("+a.model.padding/2+","+a.model.padding/2+")"),a.noteGroup.attr("id","noteGroup"),a.noteGroup.attr("focusable",!0),a.render()},a.updateValue=function(b,c){a.applier.requestChange(b,c)},a.update=function(b,c){a.applier.requestChange(b,c),a.container.children("#grid").empty(),a.draw(),a.events.afterUpdate.fire()},a.sendNoteCalc=function(){a.events.afterNoteCalc.fire(a.model.keys)}},automm.grid.finalInit=function(a){var b=a.container.find("#grid").length;a.model.auto&&1>b&&(a.container.append("<div id='grid'></div>"),b=1),b>0&&(a.draw(),a.events.afterUpdate.fire(),a.events.onNote.addListener(a.onNote),a.events.afterNote.addListener(a.afterNote),a.events.afterInstrumentUpdate.addListener(a.update),a.events.getNoteCalc.addListener(a.sendNoteCalc))}}();var automm=automm||{};!function(){"use strict";fluid.defaults("automm.instrument",{gradeNames:["fluid.viewComponent","autoInit"],model:{autoPiano:!1,autoGrid:!1,autoGui:!1,artActive:!1,columns:8,rows:8,afour:69,afourFreq:440,firstNote:60,octaves:1,octaveNotes:12,padding:0,pattern:["white","black","white","black","white","white","black","white","black","white","black","white"],keys:{white:{fill:"#ffffff",stroke:"#000000",highlight:"#fff000",selected:"#00F5FF"},black:{fill:"#000000",stroke:"#000000",highlight:"#fff000",selected:"#00F5FF"}},arpActive:!1,interval:150,scale:"major",mode:"ionian",arpPattern:[0,2,4],canon:{modes:{ionian:0,dorian:1,phyrgian:2,lydian:3,mixolydian:4,aeolian:5,locrian:6},scales:{major:[2,2,1,2,2,2,1],minor:[2,2,1,2,2,1,2]}}},events:{onNote:null,afterNote:null,afterInstrumentUpdate:null,afterGuiUpdate:null,afterNoteCalc:null,afterUpdate:null,getNoteCalc:null,afterPoly:null,onClick:null,afterClick:null,onSelect:null},components:{piano:{type:"automm.piano",container:"{instrument}.container",options:{model:{auto:"{instrument}.model.autoPiano",firstNote:"{instrument}.model.firstNote",octaves:"{instrument}.model.octaves",octaveNotes:"{instrument}.model.octaveNotes",padding:"{instrument}.model.padding",pattern:"{instrument}.model.pattern",keys:"{instrument}.model.keys"},events:{afterInstrumentUpdate:"{instrument}.events.afterInstrumentUpdate",afterNoteCalc:"{instrument}.events.afterNoteCalc",afterUpdate:"{instrument}.events.afterUpdate",getNoteCalc:"{instrument}.events.getNoteCalc"}}},grid:{type:"automm.grid",container:"{instrument}.container",options:{model:{auto:"{instrument}.model.autoGrid",columns:"{instrument}.model.columns",rows:"{instrument}.model.rows",firstNote:"{instrument}.model.firstNote",octaveNotes:"{instrument}.model.octaveNotes",padding:"{instrument}.model.padding",pattern:"{instrument}.model.pattern",keys:"{instrument}.model.keys"},events:{afterInstrumentUpdate:"{instrument}.events.afterInstrumentUpdate",afterNoteCalc:"{instrument}.events.afterNoteCalc",afterUpdate:"{instrument}.events.afterUpdate",getNoteCalc:"{instrument}.events.getNoteCalc"}}},oscillator:{type:"automm.oscillator",options:{model:{afour:"{instrument}.afour",afourFreq:"{instrument}.afourFreq",ocaveNotes:"{instrument}.octaveNotes",arpActive:"{instrument}.arpActive"},events:{onClick:"{instrument}.events.onClick",afterClick:"{instrument}.events.afterClick",onNote:"{instrument}.events.onNote",afterNote:"{instrument}.events.afterNote",afterInstrumentUpdate:"{instrument}.events.afterInstrumentUpdate"}}},gui:{type:"automm.gui",container:"{instrument}.container",options:{model:{drawGui:"{instrument}.model.drawGui",firstNote:"{instrument}.model.firstNote",octaves:"{instrument}.model.octaves",octaveNotes:"{instrument}.model.octaveNotes",padding:"{instrument}.model.padding",pattern:"{instrument}.model.pattern",keys:"{instrument}.model.keys"},events:{afterGuiUpdate:"{instrument}.events.afterGuiUpdate"}}},eventBinder:{type:"automm.eventBinder",container:"{instrument}.container",options:{events:{afterUpdate:"{instrument}.events.afterUpdate",onClick:"{instrument}.events.onClick",afterClick:"{instrument}.events.afterClick",onNote:"{instrument}.events.onNote",afterNote:"{instrument}.events.afterNote",afterPoly:"{instrument}.events.afterPoly"}}},highlighter:{type:"automm.highlighter",container:"{instrument}.container",options:{model:{keys:"{instrument}.model.keys"},events:{onClick:"{instrument}.events.onClick",afterClick:"{instrument}.events.afterClick",onNote:"{instrument}.events.onNote",afterNote:"{instrument}.events.afterNote",afterNoteCalc:"{instrument}.events.afterNoteCalc",getNoteCalc:"{instrument}.events.getNoteCalc",onSelect:"{instrument}.events.onSelect"}}},aria:{type:"automm.aria",container:"{instrument}.container",options:{model:{octaveNotes:"{instrument}.model.octaveNotes"},events:{afterUpdate:"{instrument}.events.afterGuiUpdate",onClick:"{instrument}.events.onClick",afterClick:"{instrument}.events.afterClick",onSelect:"{instrument}.events.onSelect"}}},arpeggiator:{type:"automm.arpeggiator",container:"{grid}.container",options:{model:{arpActive:"{instrument}.model.arpActive",notificationShowing:"{instrument}.model.notificationShowing",interval:"{instrument}.model.interval",scale:"{instrument}.model.scale",mode:"{instrument}.model.mode",arpPattern:"{instrument}.model.arpPattern",firstNote:"{instrument}.model.firstNote",octaves:"{instrument}.model.octaves",octaveNotes:"{instrument}.model.octaveNotes",canon:"{instrument}.model.canon"},events:{onNote:"{instrument}.events.onNote",afterNote:"{instrument}.events.afterNote",onClick:"{instrument}.events.onClick",afterClick:"{instrument}.events.afterClick",afterInstrumentUpdate:"{instrument}.events.afterInstrumentUpdate"}}}}}),automm.instrument.finalInit=function(a){a.update=function(b,c){return a.applier.requestChange(b,c),a.events.afterInstrumentUpdate.fire(b,c),a},a.events.afterGuiUpdate.addListener(a.update)}}();var automm=automm||{};!function(a){"use strict";fluid.defaults("automm.highlighter",{gradeNames:["fluid.viewComponent","autoInit"],model:{keys:{white:{width:50,height:50,stroke:"black",fill:"white",highlight:"yellow",notes:[]},black:{width:50,height:50,stroke:"black",fill:"black",highlight:"yellow",notes:[]}},arpActive:!1},events:{getNoteCalc:null,onNote:null,afterNote:null,afterNoteCalc:null,onSelect:null}}),automm.highlighter.preInit=function(a){a.currentlySelected=null,a.currentlyPlaying=[],a.afterNoteCalc=function(b){a.model.keys=b},a.onNote=function(b){b=automm.numberToNote(b,a.container),automm.updateCssFill(b,"highlight",a.model.keys),a.currentlyPlaying.push(b[0].id)},a.afterNote=function(b){var c;b=automm.numberToNote(b,a.container),c=automm.isCurrentlyPlaying(b[0].id,a.currentlyPlaying),null!==a.currentlySelected&&b[0]===a.currentlySelected[0]?automm.updateCssFill(b,"selected",a.model.keys):automm.updateCssFill(b,"fill",a.model.keys),a.currentlyPlaying.splice(c,1)},a.onClick=function(b){a.model.arpActive||a.onNote(b)},a.afterClick=function(b){a.model.arpActive||a.afterNote(b)},a.onSelect=function(b){var c;b=automm.numberToNote(b,a.container),null!==a.currentlySelected&&(c=automm.isCurrentlyPlaying(a.currentlySelected[0].id,a.currentlyPlaying),-1===c?automm.updateCssFill(a.currentlySelected,"fill",a.model.keys):automm.updateCssFill(a.currentlySelected,"highlight",a.model.keys)),automm.updateCssFill(b,"selected",a.model.keys),a.currentlySelected=b}},automm.highlighter.finalInit=function(a){a.events.onNote.addListener(a.onNote),a.events.afterNote.addListener(a.afterNote),a.events.afterNoteCalc.addListener(a.afterNoteCalc),a.events.onClick.addListener(a.onClick),a.events.afterClick.addListener(a.afterClick),a.events.onSelect.addListener(a.onSelect),a.events.getNoteCalc.fire()},automm.numberToNote=function(b,c){return"number"==typeof b&&(b=c.find("#"+b)),b=a(b)},automm.updateCssFill=function(b,c,d){-1!==a.inArray(parseInt(b[0].id,10),d.white.notes)?b.css("fill",d.white[c]):b.css("fill",d.black[c])},automm.isCurrentlyPlaying=function(b,c){var d=a.inArray(b,c);return d}}(jQuery);var automm=automm||{};!function(){"use strict";fluid.defaults("automm.gui",{gradeNames:["fluid.viewComponent","autoInit"],model:{drawGui:!1,afour:69,afourFreq:440,firstNote:60,octaves:1,octaveNotes:12,padding:0,pattern:["white","black","white","black","white","white","black","white","black","white","black","white"],keys:{white:{fill:"#fff000",stroke:"#000000",highlight:"#ffffff"},black:{fill:"#ffa400",stroke:"#000000",highlight:"#000000"}}},events:{afterGuiUpdate:null}}),automm.gui.preInit=function(a){a.init=function(){a.datgui=new dat.GUI({autoPlace:!1}),a.customContainer=a.container.children("#gui"),a.datgui.close(),a.customContainer.append(a.datgui.domElement),a.customContainer.attr("align","center").children().attr("align","left"),a.datgui.octaves=a.datgui.add(a.model,"octaves",1,5),a.datgui.firstNote=a.datgui.add(a.model,"firstNote",24,84).step(1),a.datgui.style=a.datgui.addFolder("Style"),a.datgui.padding=a.datgui.style.add(a.model,"padding",0,200),a.datgui.whiteKeys=a.datgui.style.addFolder("White Keys"),a.datgui.whiteKeysFill=a.datgui.whiteKeys.addColor(a.model.keys.white,"fill"),a.datgui.whiteKeysStroke=a.datgui.whiteKeys.addColor(a.model.keys.white,"stroke"),a.datgui.whiteKeysHighlight=a.datgui.whiteKeys.addColor(a.model.keys.white,"highlight"),a.datgui.blackKeys=a.datgui.style.addFolder("Black Keys"),a.datgui.blackKeysFill=a.datgui.blackKeys.addColor(a.model.keys.black,"fill"),a.datgui.blackKeysStroke=a.datgui.blackKeys.addColor(a.model.keys.black,"stroke"),a.datgui.blackKeysHighlight=a.datgui.blackKeys.addColor(a.model.keys.black,"highlight"),a.datgui.octaves.onChange(function(b){a.update("octaves",b)}),a.datgui.firstNote.onChange(function(b){a.update("firstNote",b)}),a.datgui.padding.onChange(function(b){a.update("padding",b)}),a.datgui.whiteKeysFill.onChange(function(b){a.update("keys.white.fill",b)}),a.datgui.whiteKeysStroke.onChange(function(b){a.update("keys.white.stroke",b)}),a.datgui.whiteKeysHighlight.onChange(function(b){a.update("keys.white.highlight",b)}),a.datgui.blackKeysFill.onChange(function(b){a.update("keys.black.fill",b)}),a.datgui.blackKeysStroke.onChange(function(b){a.update("keys.black.stroke",b)}),a.datgui.blackKeysHighlight.onChange(function(b){a.update("keys.black.highlight",b)})},a.update=function(b,c){return a.applier.requestChange(b,c),a.events.afterGuiUpdate.fire(b,c),a}},automm.gui.finalInit=function(a){a.model.drawGui&&(a.container.find("gui").length<1?a.container.append("<div id='gui' aria-hidden='true'></div>"):a.container.find("gui").attr("aria-hidden",!0),a.init(),a.container.append("<div class='buffer' style='height:50px;'></div>"))}}();var automm=automm||{};!function(a){"use strict";fluid.defaults("automm.eventBinder",{gradeNames:["fluid.viewComponent","autoInit"],model:{isShift:!1},events:{afterUpdate:null,afterClick:null,onClick:null}}),automm.eventBinder.preInit=function(b){b.bindEvents=function(){var c={},d=!1;b.polyNotes=[],a(document).keydown(function(a){a.shiftKey===!0&&(b.model.isShift=!0)}),a(document).keyup(function(a){a.shiftKey===!1&&b.model.isShift&&(b.model.isShift=!1,b.afterShift())}),b.notes=b.container.find(".note"),b.notes.each(function(e,f){f=a(f),f.mousedown(function(){c=f,d=!0,b.onClick(f)}),f.mouseup(function(){d=!1,b.model.isShift||b.events.afterClick.fire(f),c={}}),f.mouseover(function(){d&&(b.model.isShift||b.events.afterClick.fire(c),b.onClick(f)),c=f})})},b.onClick=function(c){var d=a.inArray(c,b.polyNotes);if(b.model.isShift){if(d>=0)return b.events.afterClick.fire(c),b.polyNotes.splice(d,1),b;b.polyNotes[b.polyNotes.length]=c}b.events.onClick.fire(c)},b.afterShift=function(){fluid.each(b.polyNotes,function(a){b.events.afterClick.fire(a)}),b.polyNotes=[]}},automm.eventBinder.finalInit=function(a){a.bindEvents(),a.events.afterUpdate.addListener(a.bindEvents)}}(jQuery);